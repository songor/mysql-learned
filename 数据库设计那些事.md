# 数据库设计那些事

### 需求分析

### 逻辑设计

**数据库设计范式**

第一范式（1NF）

数据库表中的所有字段都是单一属性，不可再分的。这个单一属性是由基本的数据类型所构成的，如整数、浮点数、字符串等；换句话说，第一范式要求数据库中的表都是二维表。

第二范式（2NF）

数据库中的表不存在非关键字段对任一候选关键字段的部分函数依赖。

部分函数依赖是指存在着组合关键字中的某一关键字决定非关键字的情况。

换句话说，所有单关键字段的表都符合第二范式。

第三范式（3NF）

如果数据表中不存在非关键字段对任意候选关键字段的传递函数依赖，则符合第三范式。

Boyce.Codd 范式（BCNF）

如果数据库表中不存在任何字段对任意候选关键字段的传递函数依赖，则符合 BC 范式。

也就是说如果是复合关键字，则复合关键字之间也不能存在函数依赖关系。

### 物理设计

**字段类型的选择原则**

当一个列可以选择多种数据类型时，应该优先考虑数字类型，其次是日期或二进制类型，最后是字符类型。对于相同级别的数据类型，应该优先选择占用空间小的数据类型。

在对数据进行比较（WHERE、JOIN、ORDER）操作时，同样的数据，字符处理往往比数字处理慢。

数据处理以页为单位，列的长度越小，利于性能提升。

**char 和 varchar 如何选择**

如果列中要存储的数据长度差不多是一致的，则应该考虑用 char，否则应该考虑 varchar。

如果列中的最大数据长度小于 50 Byte，则一般考虑用 char。

一般不宜定义大于 50 Byte 的 char 类型列。

**decimal 和 float 如何选择**

decimal 用于存储精确数据，而 float 只能用于存储非精确数据。

**int 和 datetime**

int 只能存储到 2038-01-19。

**主键**

区分业务主键和数据库主键

考虑主键是否要顺序增长（按主键顺序逻辑存储）

主键所占空间要尽可能小

**避免使用外键约束**

**避免使用触发器**

**严禁使用预留字段**

**反范式化**

所谓的反范式化，就是为了性能和读取效率的考虑，适当地违反第三范式的要求，允许存在少量的数据冗余，使用空间来换时间。

减少表的关联数量 / 增加数据的读取效率

### 维护优化